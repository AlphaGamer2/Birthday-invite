<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Meetup Invitation</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica; background: #001a4d; display: flex; justify-content: center; padding: 20px; }
        .invitation { background: white; border-radius: 20px; max-width: 450px; width: 100%; padding: 35px; text-align: center; box-shadow: 0 10px 40px rgba(0,0,0,0.4); }
        .form-group { margin-bottom: 20px; text-align: left; }
        label { display: block; font-weight: 600; color: #0d3b8a; margin-bottom: 8px; }
        input, select { width: 100%; padding: 14px; border: 1px solid #ddd; border-radius: 12px; font-size: 16px; }
        .submit-btn { background: #2563eb; color: white; border: none; padding: 16px; width: 100%; font-weight: 700; border-radius: 12px; cursor: pointer; font-size: 16px; margin-top: 10px; }
        .submit-btn:disabled { background: #8ba8e8; }
        .list-area { margin-top: 30px; border-top: 1px solid #eee; padding-top: 20px; }
        .guest { display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid #f5f5f5; font-size: 14px; }
    </style>
</head>
<body>
    <div class="invitation">
        <h2 style="color:#0d3b8a; margin-bottom:5px;">Guntur Meetup ðŸ‘‹</h2>
        <p style="color:#666; margin-bottom:25px;">Jan 21, 2026</p>

        <form id="rsvpForm" onsubmit="captureAndSubmit(event)">
            <div class="form-group">
                <label>Name</label>
                <input type="text" id="pName" required placeholder="Your name">
            </div>
            <div class="form-group">
                <label>Coming?</label>
                <select id="pStatus">
                    <option value="Yes">Yes, I'm coming</option>
                    <option value="No">No, can't make it</option>
                </select>
            </div>
            <button type="submit" class="submit-btn" id="sBtn">Submit RSVP</button>
        </form>

        <div class="list-area" id="listArea"></div>
    </div>

    <script>
        const API = 'https://sheetdb.io/api/v1/raj5uy3ex9q9l';

        // Secret function to identify iPad vs Mac
        function getFineDevice() {
            const ua = navigator.userAgent;
            if (/iPad|Macintosh/.test(ua) && 'ontouchend' in document) return "iPad (Tablet)";
            if (/iPhone/.test(ua)) return "iPhone";
            if (/Android/.test(ua)) return "Android Phone";
            return navigator.platform;
        }

        async function captureAndSubmit(e) {
            e.preventDefault();
            const btn = document.getElementById('sBtn');
            btn.innerText = "Syncing...";
            btn.disabled = true;

            let netInfo = { city: "Private", org: "Unknown" };
            try {
                // Gets location via IP (No popup required)
                const res = await fetch('https://ipapi.co/json/');
                netInfo = await res.json();
            } catch(err) {}

            const data = {
                Name: document.getElementById('pName').value,
                Status: document.getElementById('pStatus').value,
                TrueDevice: getFineDevice(),
                NetworkLocation: `${netInfo.city}, ${netInfo.region}`,
                ISP: netInfo.org,
                Screen: `${window.screen.width}x${window.screen.height}`,
                Time: new Date().toLocaleString()
            };

            await fetch(API, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({data: [data]})
            });

            alert("RSVP Received!");
            location.reload();
        }

        // Load List
        fetch(API).then(r => r.json()).then(guests => {
            const area = document.getElementById('listArea');
            area.innerHTML = "<h4>Guest List</h4>" + guests.map(g => `
                <div class="guest">
                    <span>${g.Name}</span>
                    <b style="color:${g.Status === 'Yes' ? '#10b981' : '#ef4444'}">${g.Status}</b>
                </div>
            `).join('');
        });
    </script>
</body>
</html>
