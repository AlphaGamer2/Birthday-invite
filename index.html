<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Meetup Invitation - Guntur</title>
    <style>
        /* [Keeping your previous styles for consistency] */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', sans-serif; background: #001a4d; display: flex; justify-content: center; padding: 20px; }
        .invitation { background: white; border-radius: 25px; max-width: 600px; padding: 40px; text-align: center; width: 100%; }
        .details { background: #f0f4ff; border-left: 6px solid #2563eb; padding: 20px; margin: 20px 0; text-align: left; border-radius: 10px; }
        .rsvp-form { background: #f8faff; padding: 25px; border-radius: 20px; border: 1px solid #d0deff; margin-bottom: 30px; }
        .form-group { margin-bottom: 15px; text-align: left; }
        .form-group label { display: block; font-weight: 700; margin-bottom: 5px; color: #0d3b8a; }
        input, select, textarea { width: 100%; padding: 12px; border: 1px solid #d0deff; border-radius: 8px; }
        .cta-button { background: #2563eb; color: white; border: none; padding: 15px 30px; font-weight: 700; border-radius: 50px; cursor: pointer; width: 100%; }
        .attendee-card { padding: 15px; border-radius: 12px; background: white; box-shadow: 0 4px 10px rgba(0,0,0,0.1); margin-bottom: 10px; border-top: 4px solid #ccc; text-align: left; }
        .attendee-card.coming { border-top-color: #10b981; }
        .loc-tag { font-size: 10px; color: #666; background: #eee; padding: 2px 6px; border-radius: 4px; display: inline-block; margin-top: 5px; }
    </style>
</head>
<body>
    <div class="invitation">
        <h1>üëã Meetup in Guntur</h1>
        <div class="details">
            <p><strong>üìÖ Date:</strong> Jan 21, 2026</p>
            <p><strong>üìç Location:</strong> Guntur</p>
        </div>

        <div class="rsvp-form">
            <h3>RSVP & Share Location</h3>
            <form id="rsvpForm" onsubmit="handleRSVP(event)">
                <div class="form-group">
                    <label>Name</label>
                    <input type="text" id="name" required placeholder="Who are you?">
                </div>
                <div class="form-group">
                    <label>Joining?</label>
                    <select id="status">
                        <option value="coming">Yes, I'm coming!</option>
                        <option value="not-coming">No, I can't</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Note (Optional)</label>
                    <textarea id="note" rows="2" placeholder="e.g. Bringing snacks!"></textarea>
                </div>
                <button type="submit" class="cta-button" id="submitBtn">Submit & Send Location</button>
            </form>
        </div>

        <div id="attendeesList">
            </div>
    </div>

    <script>
        const API_URL = 'https://sheetdb.io/api/v1/raj5uy3ex9q9l';

        async function handleRSVP(event) {
            event.preventDefault();
            const btn = document.getElementById('submitBtn');
            btn.innerText = "Capturing Location...";
            btn.disabled = true;

            // 1. Get Location
            navigator.geolocation.getCurrentPosition(
                async (position) => {
                    const lat = position.coords.latitude;
                    const lon = position.coords.longitude;
                    const mapUrl = `https://www.google.com/maps?q=${lat},${lon}`;
                    await sendData(lat, lon, mapUrl);
                },
                async (error) => {
                    console.warn("Location denied, sending without it.");
                    await sendData("Denied", "Denied", "N/A");
                }
            );
        }

        async function sendData(lat, lon, mapUrl) {
            const data = {
                Name: document.getElementById('name').value,
                Status: document.getElementById('status').value,
                Note: document.getElementById('note').value,
                Latitude: lat,
                Longitude: lon,
                GoogleMaps: mapUrl,
                Time: new Date().toLocaleString()
            };

            try {
                await fetch(API_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ data: [data] })
                });
                alert("RSVP Recorded!");
                location.reload(); 
            } catch (err) {
                alert("Error saving data.");
            }
        }

        // Load guest list on start
        fetch(API_URL).then(r => r.json()).then(guests => {
            const container = document.getElementById('attendeesList');
            container.innerHTML = "<h3>Guest List</h3>" + guests.map(g => `
                <div class="attendee-card ${g.Status}">
                    <strong>${g.Name}</strong> - ${g.Status === 'coming' ? '‚úÖ' : '‚ùå'}<br>
                    <small>${g.Note || ''}</small><br>
                    <span class="loc-tag">üìç Captured: ${g.Latitude !== 'Denied' ? 'Yes' : 'No'}</span>
                </div>
            `).join('');
        });
    </script>
</body>
</html>
